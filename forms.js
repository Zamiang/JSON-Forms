JSONFORMS={buildForms:function(a,b,c){var d=this,e=[],f=a.map(function(g){return'<div id="'+g+'"></div>'}).join("");c.html(f);a.map(function(g){var j="#"+g;g=b[g].map(function(h){var k=d.getModuleForSection(h);h.hide!==undefined&&k.jObj.hide();k.jObj.find(".text").text(h.name+":");k.jObj.find(".tip").html(h.tip);k.jObj.find(".help").html(h.help);k.jObj.find(".extra_help").html(h.extra_help);k.id=h.id;k.type=h.type;k.required=h.required;k.sub=h.sub;k.placeholder=h.placeholder;e.push(k);return k.jObj});
jQuery.fn.append.apply(c.find(j),g);return true});return e},getModuleForSection:function(a){var b={};return b=a.type=="checkbox"?this.makeCheckboxForm(a):a.type=="location"?this.makeLocationForm(a):a.type=="org_search"?this.makeOrgSearchForm(a):a.type=="multi_org_search"?this.makeMultiOrgSearchForm(a):a.type=="list"?this.makeListForm(a):a.type=="multi_location"?this.makeMultiLocationForm(a):a.type=="radio"?this.makeRadioForm(a):a.type=="accomplishments"?this.makeAccomplishmentsForm(a):a.type=="select"?
this.makeSelectForm(a):a.type=="statistics"?this.makeStatisticsForm(a):a.type=="dependent_select"?this.makeDependentSelectForm(a):a.type=="text"?this.makeTextForm(a):a.type=="multi_select"?this.makeMultiSelect(a):a.type=="password"?this.makePasswordForm(a):this.makeTweetForm(a)},makeSelectForm:function(a){var b=jQuery("#templates .select_form").clone();b.find("select").append(this._makeSelectOptions(a.options,a.val));b.find("input").val(a.val);return{jObj:b,val:function(){return this.jObj.find("select").val()}}},
makeStatisticsForm:function(a){var b=JUMO.Util.newify(Accomplishment,jQuery("#templates .accomplishments").clone(),a.name,a.val,"statistics");return{jObj:this.getObj(b,a.id,a.name,a.tip,a.help,a.hidden),val:function(){return b.val()}}},makeAccomplishmentsForm:function(a){var b=JUMO.Util.newify(Accomplishment,jQuery("#templates .accomplishments").clone(),a.name,a.val);return{jObj:this.getObj(b,a.id,a.name,a.tip,a.help,a.hidden),val:function(){return b.val()}}},makeListForm:function(a){var b=JUMO.Util.newify(OrderedList,
a,jQuery("<div><ul></ul></div>"));return{jObj:this.getObj(b,a.id,a.name,a.tip,a.help,a.hidden),val:function(){if(b.val()!==undefined&&b.val().length>0)return b.val();return[]}}},makeTweetForm:function(a){var b,c=a.max_length||200;if(a.counter!==undefined){b=jQuery("#templates .text_form").clone();b.find(".editable").css({height:"94px"}).html(a.val);JUMO.Util.makeCharCountDiv(b.find(".editable"),b.find(".tip"),c)}else{b=jQuery("#templates .tweet_form").clone();b.find("input").val(JUMO.Util.trim(String(a.val)))}b.attr({"data-max":c});
if(!a.val&&a.placeholder!==undefined){b.find("input:eq(0)").attr("placeholder",a.placeholder);b.find("input:eq(0)").val(a.placeholder);b.find("input:eq(0)").addClass("placeholder")}return{jObj:b,val:function(){if(this.jObj.find("input").val()){if(this.jObj.find("input").val()!=this.jObj.find("input").attr("placeholder"))return this.jObj.find("input").val()}else if(this.jObj.find(".editable").text()!=this.jObj.find(".editable").attr("placeholder"))return this.jObj.find(".editable").text();return""}}},
makeLocationForm:function(a){var b,c=this,d=this.locationToString(a.val);if(d!==undefined){c.locationVal=a.val;b=jQuery("#templates .location_form").clone();b.find(".loc .location_string").text(d)}else{b=jQuery("#templates .tweet_form").clone();this.makeLocationDiv(b.find("input"),this)}if(!a.val&&a.placeholder!==undefined){b.find("input:eq(0)").attr("placeholder",a.placeholder);b.find("input:eq(0)").val(a.placeholder);b.find("input:eq(0)").addClass("placeholder")}return{jObj:b,val:function(){if(c.locationVal==
this.jObj.find("input").attr("placeholder"))return"";return c.locationVal}}},makeOrgSearchForm:function(a){var b;b=jQuery("#templates .tweet_form").clone();JUMO.setupSearch(b.find("input"),[],function(c){a["data-val"]=c.id},a.restrictType);b.find("input").val(a.val);return{jObj:b,val:function(){return this.jObj.find("input").val()?[a["data-val"]]:[]}}},makeMultiOrgSearchForm:function(a){var b=JUMO.Util.newify(OrderedList,a,jQuery("<div><ul></ul></div>"));return{jObj:this.getObj(b,a.id,a.name,a.tip,
a.help,a.hidden),val:function(){return b.val()}}},makeCheckboxForm:function(a){var b=jQuery("#templates .checkbox").clone();a.text!==undefined&&b.append(a.text);a.val!="False"&&b.find("input").attr("checked",true);return{jObj:b,val:function(){return b.find("input['type=checkbox']:checked").length>0?true:false}}},makeRadioForm:function(a){var b=jQuery("#templates .radio_form").clone();a.help!==undefined&&b.find(".help").val(a.help);b.find(".radio_group").append(this._makeRadioOptions(a.options,a.val,
a.name));return{jObj:b,val:function(){return b.find("input[type=radio]:checked").val()}}},makePasswordForm:function(){var a=jQuery("#templates .password_form").clone();return{jObj:a,val:function(){if(a.find("input").val())return a.find("input").val()}}},makeTextForm:function(a){var b=jQuery("#templates .text_form").clone(),c=b.find(".editable");if(!a.val&&a.placeholder!==undefined){c.attr("placeholder",a.placeholder);c.text(a.placeholder);c.addClass("placeholder")}else c.html(a.val);c.bind("focus unfocus",
function(d){JUMO.Util.fixPlaceHolder(jQuery(this),d.type)});return{jObj:b,val:function(){if(c.text()==c.attr("placeholder"))return"";return c.text()}}},_makeRadioOptions:function(a,b,c){return a.map(function(d){return"<input type='radio' name='"+c+"' "+(d.val==b?"checked":"")+(d.val?' value="'+d.val+'"':"")+"/>"+(d.name||d.val)}).join("")},_makeSelectOptions:function(a,b){return a.map(function(c){return"<option "+(c.val==b?"selected":"")+(c.val?' value="'+c.val+'"':"")+">"+(c.name||c.val)+"</option>"}).join("")},
_makeSelectForm:function(a,b){return jQuery('<select style="width:100%"><option></option>'+this._makeSelectOptions(a,b)+"</select>")},makeDependentSelectForm:function(a){return JUMO.Util.newify(DependentSelect,a)},makeMultiLocationForm:function(a){return JUMO.Util.newify(MultiLocationForm,a)},makeMultiSelect:function(a){var b=this._makeSelectForm(a.options,a.val),c=a.val&&a.val.length>0?"":b.clone().val(""),d=jQuery('<div class="form_group"><div class="label">'+a.name+'</div><div class="sel" style="display:inline-block; width:30%;"></div>');
jQuery.fn.append.apply(d.find(".sel"),a.val.map(function(e){var f=b.clone();f.val(e+"");return f})).append(c).append(jQuery("#templates .add").clone().click(function(e){e.stopPropagation();jQuery(this).before(b.clone())}));return{jObj:d,val:function(){return d.find("select").map(function(e){return jQuery(e).val()||undefined})}}},editLocation:function(a){this.locationEdited=true;a=jQuery(a).parent().html('<input id="m_location" type="text" style="width:282px;" value=""/>');this.parent.locationVal=
{};this.makeLocationDiv(a.find("input"),this.parent)},makeLocationDiv:function(a,b,c){var d=this;c=c||function(e){return b.setLocationVal(e,a)};a.autocomplete({source:function(e,f){Checker.getLocationForString(e.term,function(g){Checker.clearError(a);f(g)},function(){f([])})},minLength:2,focus:function(e,f){a.val(d.locationToString(f.item));return false},open:function(){jQuery(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){jQuery(this).removeClass("ui-corner-top").addClass("ui-corner-all")},
select:function(e,f){Checker.clearError(a);a.val(d.locationToString(f.item));c(f.item);return false}}).data("autocomplete")._renderItem=function(e,f){jQuery("<li></li>").data("item.autocomplete",f).append("<a>"+d.locationToString(f)+"</a>").appendTo(e);return f}},locationToString:function(a){var b="";if(!a)return"";var c;try{if(JSON&&JSON.parse&&a.raw_geodata)if((c=JSON.parse(a.raw_geodata))&&c.raw_geodata)if((c=JSON.parse(c.raw_geodata))&&c.raw_geodata)c=JSON.parse(c.raw_geodata)}catch(d){}if(a.name&&
a.name!=a.locality)b+=a.name+" ";else if(c&&c.name&&c.name!=a.locality&&c.name!=a.region&&c.name!=a.country_name)b+=c.name+" ";else if(a.locality)b+=a.locality+", ";if(a.region&&a.region!=a.name)b+=a.region+" ";if(a.country_name&&a.country_name!=a.name)b+=a.country_name;if(a.type)b+=" ("+a.type+")";return JUMO.Util.trim(b)},makeComboBox:function(a,b,c,d){a.html("<select>"+b.map(function(e){return'<option value="val"'+(e==c?"selected":"")+">"+e+"</option>"})+"</select");return JUMO.Util.newify(ComboBox,
a,b,c,d)},getObj:function(a,b,c,d,e,f){return jQuery('<div class="form_group"'+(f?'style="display:none"':"")+'><div class="label"><span class="text">'+c+'</span><div class="tip">'+(d||"")+'</div><div class="help">'+(e||"")+"</div></div></div>").append(a.jObj)}};JSONFORMS.builder={parent:JSONFORM,MultiLocationForm:{initialize:function(a){this.defaultText="enter a location";this.makeMultiLocationForm(a)},makeMultiLocationForm:function(a){var b=this,c=JUMO.Util.newify(OrderedList,a,jQuery("<div><ul></ul></div>"),false),d=FormMaker.getObj(c,a.id,a.name,a.tip,a.help,a.hidden);d.children().eq(1).append(jQuery("#templates .add").clone().click(function(){b.addBlankLocationForm(jQuery(this).parent().find("ul"));b.makeRemove(d.find(".remove:last"))}));if(!a.val||
a.val.length<1)this.addBlankLocationForm(d.find("ul"));this.makeRemove(d.find(".remove"));this.orderedListModule=c;this.jObj=d},addBlankLocationForm:function(a){var b=this,c=jQuery('<div class="sortable_item"><input type="text" style="width:282px;" value=""/><img class="remove" src="/static/img/close.png" /><img src="/static/img/moveable.png" /></div>');a.append(c);FormMaker.makeLocationDiv(c.find("input"),this,function(d){b.setVal(c,d)})},makeRemove:function(a){return a.click(function(b){b.stopPropagation();
jQuery(this).parent().slideUp("slow",function(){jQuery(this).remove()})})},setVal:function(a,b){a.data("location",b)},getVal:function(a){return a.data("location")},val:function(){var a=[],b=this;this.jObj.find(".sortable_item").each(function(){var c=b.getVal(jQuery(this));c&&a.push(c)});return a}},ComboBox:{initialize:function(a){jQuery.widget("ui.combobox",{_create:function(){var b=this,c=a.find("select").hide(),d=c.children(":selected");d=d.val()?d.text():"";var e=jQuery("<input>").insertAfter(a).val(d).autocomplete({delay:0,
minLength:0,source:function(f,g){var j=RegExp(jQuery.ui.autocomplete.escapeRegex(f.term),"i");g(c.children("option").map(function(){var h=jQuery(this).text();if(this.value&&(!f.term||j.test(h)))return{label:h.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+jQuery.ui.autocomplete.escapeRegex(f.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:h,option:this}}))},select:function(f,g){g.item.option.selected=true;b._trigger("selected",f,{item:g.item.option})},change:function(f,g){if(!g.item){var j=
RegExp("^"+jQuery.ui.autocomplete.escapeRegex(jQuery(this).val())+"$","i");c.children("option").each(function(){if(this.value.match(j)){this.selected=true;return false}})}}}).addClass("ui-widget ui-widget-content ui-corner-left");e.data("autocomplete")._renderItem=function(f,g){return jQuery("<li></li>").data("item.autocomplete",g).append("<a>"+g.label+"</a>").appendTo(f)};jQuery("<button>\u25bc</button>").attr("tabIndex",-1).attr("title","Show All Items").insertAfter(e).button({icons:{primary:"ui-icon-triangle-1-s"},
text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").click(function(){if(e.autocomplete("widget").is(":visible"))e.autocomplete("close");else{e.autocomplete("search","");e.focus()}})}});return a.combobox()}},OrderedList:{initialize:function(a,b,c){var d=this;this.section=a;this.listID=a.id;this.listType=a.type;this.listItems=a.val;this.jObj=b;b.addClass("sortable_cont").html("<ul></ul>").parent().find(".add").remove();this.makeSortable(b.find("ul"),this.listItems);
c===undefined?this.makeEditSaveToggle(b.find(".edit")):b.find(".edit").hide();this.makeRemove(b.find(".remove"));if(c!==undefined)return b;b.append(jQuery("#templates .add").clone().click(function(e){e.stopPropagation();d.makeNewRow(b)}));if(!a.val||a.val.length<1)this.makeNewRow(b);return b},makeNewRow:function(a){var b=jQuery("#templates .sortable_item").clone().find(".txt").end();this.makeEditSaveToggle(b.find(".edit"));this.makeRemove(b.find(".remove"));a.find("ul").append(b);a.sortable("refresh");
this.makeEditable(b.parent().find(".txt").last(),b.find(".edit"))},makeEditable:function(a,b){var c=a.text();if(this.listType=="multi_org_search"){a.html('<input type="text" style="width:70%" class="placeholder" placeholder="enter the name of an org" value="'+a.text()+'" />');JUMO.setupSearch(a.find("input"),[],function(d){a.attr({"data-val":d.id})},this.section.restrictType)}else FormMaker.makeComboBox(a,eval(this.listID.toUpperCase()+"TAGSLIST"),c,this);b.text("save")},makeSortable:function(a,b){var c=
this,d=jQuery("#templates .sortable_item");navigator.userAgent.toLowerCase();jQuery.each(b,function(e,f){if(c.listType=="multi_location")a.append(d.clone().data("location",f).find(".txt").text(FormMaker.locationToString(f)).end());else if(f.name&&f.name.length>0)a.append(d.clone().attr({"data-type":f.type}).find(".txt").text(f.name).end());else c.section["data-val"]!==undefined&&a.append(d.clone().find(".txt").text(f).attr({"data-val":c.section["data-val"][e]}).end())});return a.sortable({handle:""})},
getObj:function(){return jQuery('<div class="form_group"><div class="label"><span class="text"></span><div class="tip"></div><div class="help"></div></div></div>').append(this.jObj)},makeEditSaveToggle:function(a){var b=this;return a.click(function(c){c.stopPropagation();c=jQuery(this);var d=c.text(),e=c.parent().find(".txt");d=="edit"?b.makeEditable(e,c.parent().find(".edit")):b._saveEditedTag(c,e)})},_inputHasValue:function(a){if(!a.val()||a.val().length>500||a.val().length<1||a.val()==a.attr("placeholder"))return false;
return true},_saveEditedTag:function(a,b){if(this.listType=="multi_org_search"){if(this._inputHasValue(b.find("input"))){a.hide();b.html(b.find("input").val())}}else if(this._inputHasValue(b.parent().find("input"))){a.hide();b.html(b.parent().find("input").val());b.parent().find("input, button").remove()}},makeRemove:function(a){return a.click(function(b){b.stopPropagation();jQuery(this).parent().slideUp("slow",function(){jQuery(this).remove()})})},val:function(){var a=[],b=this;this.jObj.find(".edit").each(function(){jQuery(this).text()==
"save"&&jQuery(this).click()});this.jObj.find(".txt").each(function(c,d){var e,f=jQuery(d);if(b.listType=="multi_org_search")e=f.attr("data-val");else if(jQuery(d).text()&&JUMO.Util.trim(jQuery(d).text()).length>1&&jQuery(d).text().length<100)e={name:jQuery(d).text(),tag_rank:c+1,type:b.listID};e&&e!==b.defaultText&&e!==f.attr("placeholder")&&a.push(e)});return a}}};JSONFORMS.placemaker={config:{appID:"Rl9xiX7a"},getPlaces:function(a,b,c){this.cont=b;this.errorcont=c;a='select * from geo.places where text="'+a.replace(",","")+'" | sort(field="areaRank", descending="true")';a="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(a)+"&format=json&callback=Placemaker.retrieve&appid="+this.config.appID;b=document.createElement("script");b.setAttribute("src",a);document.getElementsByTagName("head")[0].appendChild(b)},retrieve:function(a){if(a!==undefined&&
a.query!==undefined&&a.query.count>0)return this.cont(a.query.results.place);return this.errorcont("location fail")}};JSONFORMS.checker={check:function(a,b,c,d,e){if(d=="multi_select"){var f=[];a.find("select").map(function(g,j){var h=jQuery(j).val();h&&f.indexOf(h)<0&&f.push(h)});return f}else if(d=="list")return b;else if(!e&&(!b||b.length<1)&&d!="checkbox")return"";else if(e&&(!b||b.length<1)&&d!="checkbox"){if(d=="statistics"||d=="accomplishments")return b;this.showError(a,"please enter a "+c,d);return false}else if(d=="name")return this.checkName(a,b,c,d,e);else if(d=="text"){b=JUMO.Util.trim(b);return this.checkText(a,
b,c,d,e)}else if(d=="tweet")return this.checkTweet(a,b,c,d,e);else if(d=="fbid"){b=this.cleanupNumber(b);return this.checkFbid(a,b,c,d,e)}else if(d=="twitterid")return FormUtils.normalizeTwitterId(b);else if(d=="ein"){b=this.cleanupNumber(b);return this.checkEin(a,b,c,d,e)}else if(d=="body")return this.checkBody(a,b,c,d,e);else if(d=="url")return this.checkURL(a,b,c,d,e);else if(d=="email")return this.checkEmail(a,b,c,d,e);else if(d=="password")return this.checkPassword(a,b,c,d,e);else if(d=="year")return this.checkYear(a,
b,c,d,e);else if(d=="number"){b=this.cleanupNumber(b);return this.checkNumber(a,b,c,d,e)}else return d=="location"?"":d=="phone"?this.checkPhoneNumber(a,b,c,d,e):b},cleanupNumber:function(a){return String(a).replace("\n","").replace("\r","").replace("\t","").replace(" ","")},checkPassword:function(a,b,c,d){if(b.length>6&&b.length<200){this.unHighlightDiv(a);return b}this.showError(a,"Your password must be at least 7 characters",d);return false},checkYear:function(a,b,c,d){if(Validator.isValidYear(Number(b))){this.unHighlightDiv(a);
return b}this.showError(a,'Please enter a valid year like "1986"',d);return false},checkNumber:function(a,b,c,d){if(Validator.isValidNumber(b)){this.unHighlightDiv(a);return b}this.showError(a,'Please enter a valid number "1234567890"',d);return false},checkPhoneNumber:function(a,b,c,d){if(Validator.isValidPhoneNumber(b)){this.unHighlightDiv(a);return String(b)}else if(Validator.isValidInternationalNumber(b)){this.unHighlightDiv(a);return String(b)}else{this.showError(a,"Please enter a valid phone number like 1-123-456-7890 or +1-541-754-3010",
d);return false}},checkName:function(a,b,c,d){if(b.length>0&&b.length<32){this.unHighlightDiv(a);return b}this.showError(a,"Please enter a "+c,d);return false},_stripHtml:function(a){return jQuery("<div>"+a+"</div>").text()},stripHtml:function(a){a=this._stripHtml(a);if(this._stripHtml("<\n>")!=="&lt;\n&gt;")return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return a},checkText:function(a,b){return b},checkTweet:function(a,b,c,d){var e=a.attr("data-max")||200;if(b.length<e){this.unHighlightDiv(a);
return b}this.showError(a,"your "+c+" must contain less than "+e+" characters",d);return false},checkFbid:function(a,b){this.unHighlightDiv(a);return b},checkEin:function(a,b,c,d){if(b)b=b.replace("-","");if(Validator.isValidEINNumber(b)){this.unHighlightDiv(a);return b}this.showError(a,"Please enter a valid EIN",d);return false},checkBody:function(a,b){return b},checkURL:function(a,b,c,d,e){b=b.indexOf("http://")<0&&b.indexOf("https://")<0?"http://"+b:b;if(e&&b.length<1){this.showError(a,"Please enter a "+
c,d);return false}else if(b.length>3&&Validator.isValidUrl(b)&&b.length<200){this.unHighlightDiv(a);return b}this.showError(a,"Please enter a valid "+c,d);return false},checkEmail:function(a,b,c,d){if(b=="foo@bar.com"){this.errorType=d;return this.showError(a,'how dare you try to invoke <a href="http://bar.com/" target="_blank">The Foo</a>',d)}else if(b.length>0&&Validator.isValidEmail(b)&&b.length<200){this.unHighlightDiv(a);return b}this.showError(a,"Please enter a valid E-mail address",d);return false},
showError:function(a,b,c){this.highlightDiv(a);this.errorType=c;return this.findNotificationDiv(a).slideDown(50).append(b+"<br />")},showParsedError:function(a,b){var c=JUMO.Util.getParsedErrorText(b);this.highlightDiv(a);return this.findNotificationDiv(a).slideDown(50).append(c+"<br />")},clearError:function(a){this.errorType=undefined;return this.findNotificationDiv(a).html("").hide()},disableSubmit:function(a){a.addClass("disabled")},enableSubmit:function(a){a.removeClass("disabled")},highlightDiv:function(a){return a.addClass("highlight")},
unHighlightDiv:function(a){return a.removeClass("highlight")},findNotificationDiv:function(a){a=a.parent().parent().find(".notification");return a.length>0?a:jQuery(jQuery.find(".submit_spacer .notification"))},hideNotificationDiv:function(a){return this.findNotificationDiv(a).slideUp(100).html("")},getLocationForString:function(a,b,c){Placemaker.getPlaces(a,function(d){if(d){JUMO.Util.isArrayLike(d)||(d=[d]);b(d.filter(function(e){return e.placeTypeName&&e.placeTypeName.content=="State"?false:true}).map(function(e){var f=
{name:e.name?e.name:"",latitude:e.centroid?e.centroid.latitude:"",longitude:e.centroid?e.centroid.longitude:"",postal_code:e.uzip||(e.postal?e.postal.content:undefined)||"",address:e.line1?e.line1:"",type:e.placeTypeName&&e.placeTypeName.content?e.placeTypeName.content:"",raw_geodata:e};["locality1","locality2","admin1","admin2","admin3","country","town","suburb"].filter(function(g){return e[g]?true:false}).map(function(g){var j=e[g].type;if(j=="Country")f.country_name=e[g].content;else if(j=="State"||
j=="County"&&e[g].content=="Brooklyn")f.region=e[g].content;else if(j=="Local Administrative Area"||j=="Town")f.locality=e[g].content});return f}))}},c)},validateFormModules:function(a,b){var c=this,d=true,e={id:a};b.map(function(f){if(f&&f!==undefined&&f.id!==undefined&&f.id!="location"){var g=c.check(f.jObj,f.val(),f.id,f.type,f.required);if(g!==false||f.type=="checkbox")if(f.sub!==undefined){e[f.sub]||(e[f.sub]={});e[f.sub][f.id]=g}else e[f.id]=g;else d=false}});if(d)return e},getValidatedForm:function(a,
b){var c=this,d=true;Object.keys(b).map(function(e){b[e].map(function(f){if(f!==undefined&&f.id!==undefined&&f.id!="location"){var g=c.check(jQuery(f.div_id),jQuery(f.div_id).val(),f.name,f.type,f.required);if(g!==false||f.type=="checkbox")if(f.sub!==undefined){a[f.sub]||(a[f.sub]={});a[f.sub][f.id]=g}else a[f.id]=g;else d=false}})});if(d)return a}};JSONFORMS.helpers={getParsedErrorText:function(a){var b="There was an error processing your request. Please try submitting again.";if(a&&a.error)b="("+a.error_code+") "+a.error;return b},addLoadingImg:function(a){a.append('<img class="loading" src="../img/ajax-loader.gif" />').css({opacity:0.5})},removeLoadingImg:function(a){a.css({opacity:1}).parent().find(".loading, .sm_loading").remove()},postJSONandDisplayLoading:function(a,b,c,d,e){var f=this,g=this.showLoading(d,e);this.postJSON(a,b,c,function(){f.hideLoading(d,
e,g)})},save:function(a,b){try{if(a.hasClass("disabled"))return false;this.addLoadingImg(a.parent());Checker.disableSubmit(a);Checker.clearError(a);b()}catch(c){a.removeClass("disabled");Checker.showError(a,JSON.stringify(c));this.removeLoadingImg(a.parent())}},showHTTPError:function(a){a&&a.status==404||(a&&a.status==502?JUMO.Modules.Popup.showErrorPopup("Error: you place an incorrectly formed request"):JUMO.Modules.Popup.showErrorPopup("An unknown error has occured."))},postJSON:function(a,b,c,
d,e){var f=this;b._xsrf=function(g){return(g=document.cookie.match("\\b"+g+"=([^;]*)\\b"))?g[1]:undefined}("_xsrf");jQuery.ajax({type:"POST",url:"/json/v1/"+a,data:b,success:function(g){try{c(eval(g));d&&d()}catch(j){f.popup.showErrorPopup(JSON.stringify(j))}},error:e?function(){e(f.defaultErrorMessage)}:this.showHTTPError,dataType:"json"})},initPlaceholder:function(a){return a.val(a.attr("placeholder")).addClass("placeholder")},fixPlaceHolder:function(a,b){var c=this.trim(a.val())||this.trim(a.text()),
d=this.trim(a.attr("placeholder"));b=="focusin"&&a.removeClass("placeholder");if(d==c||!c&&b=="focus")a.val("").removeClass("placeholder").text("");else if(!c&&b=="focusout"||!c&&b=="blur")a.val(d).addClass("placeholder").text(d)},getFormVal:function(a){var b=this.trim(a.val());a=this.trim(a.attr("placeholder"));return b==a?"":b},linkifyTweet:function(a){return a.replace(/(^|\s)(@\w+)/gm,'$1<a href="http://twitter.com/$2">$2</a>')},showhideTabs:function(a,b){a=a.replace(" selected","");a=a.split(" ")[0];
b.map(function(c){var d=jQuery("#"+c);if(c!=a){jQuery("."+c).removeClass("selected");d.hide(0)}else{jQuery("."+c).addClass("selected");jQuery(window).scrollTop(0);d.show()}})},getUrlParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return a==null?"":decodeURIComponent(a[1].replace(/\+/g," "))},normalizeTwitterId:function(a){try{return a.replace("http://","").replace("https://","").replace("www.","").replace("twitter",
"").replace(".com/","").replace(".com","").replace("@","")}catch(b){return""}},clearDefault:function(a,b){if(jQuery(a).val()==b){jQuery(a).val("");jQuery(a).removeClass("placeholder")}},getInputs:function(a){return jQuery("#"+a+" input")},restoreDefault:function(a,b){if(!jQuery(a).val()||jQuery(a).val()===""){jQuery(a).val(b);jQuery(a).addClass("placeholder")}},checkAll:function(){jQuery("input:checkbox").each(function(){jQuery(this).attr("checked",true)})},uncheckAll:function(){jQuery("input:checkbox").each(function(){jQuery(this).attr("checked",
false)})},attachFormDefaults:function(){var a=this;jQuery("input, textarea").each(function(){jQuery(this).focus(function(){FormUtils.clearDefault(jQuery(this),jQuery(this).attr("placeholder"))});jQuery(this).blur(function(){FormUtils.restoreDefault(jQuery(this),jQuery(this).attr("placeholder"))});a.restoreDefault(this)})},setCursor:function(a,b){if(a=typeof a=="string"||a instanceof String?document.getElementById(a):a)if(a.createTextRange){var c=a.createTextRange();c.collapse(true);c.moveEnd(b);c.moveStart(b);
c.select();return true}else if(a.setSelectionRange){a.setSelectionRange(b,b);return true}return false}};JSONFORMS.validator={isValidEmail:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)},
isValidUrl:function(a){return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
accept:function(a,b,c){c=typeof c=="string"?c.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||a.match(RegExp(".("+c+")$","i"))},isValidCreditCard:function(a){a=a.split(" ").join("");if(a===undefined||a.length<1||a.length>19)return false;a=JUMO.Util.reverse(String(a));var b=0,c=0;c="";for(var d=0;d<a.length;d++){if(d%2){c=a.substr(d,1)*2;if(c>=10){c=String(c);c=parseInt(c.substr(0,1),10)+parseInt(c.substr(1,1),10)}}else c=a.substr(d,1);b+=parseInt(c,10)}return b%10?false:true},isValidYear:function(a){return/^[12][890][0-9][0-9]$/.test(a)},
isValidName:function(a){return/^[\w ]+$/i.test(a)},isValidString:function(a){return/^[\w \d \. \, \' \" \: \@ \; \? \- \# \\u2013 \% \& \( \) \! \s \: \; \- \! \r \+ \/ \* \\u2014 \\u2019]+$/i.test(a)},isValidNumber:function(a){return JUMO.Util.isNumeric(a)},isValidFbid:function(a){return JUMO.Util.isNumeric(a)},isValidEINNumber:function(a){return JUMO.Util.isNumeric(a)&&String(a).length<10&&String(a).length>8},isValidInternationalNumber:function(a){return/^\+(?:[0-9] ?){6,14}[0-9]$/.test(a)},isValidPhoneNumber:function(a){return/^(?:\+?1[-. ]?)?\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(a)},
isAlphanumeric:function(a){return/^\w+$/i.test(a)}};FORMUTIL={sentenceCase:function(){return this.toLowerCase().replace(/^(.)|\s(.)/g,function(a){return a.toUpperCase()})},capitalize:function(a){return a.replace(/(^|\s)([a-z])/g,function(b,c,d){return c+d.toUpperCase()})},str_trim:function(a){if(a!==undefined)return a.replace(/^\s+|\s+$/g,"");return a},trim:function(a){return a?a.trim!==undefined?a.trim():JUMO.Util.str_trim(a):""},areObjectsEquivalent:function(a,b){for(var c in a)if(typeof b[c]=="undefined")return false;for(c in a)if(a[c])switch(typeof a[c]){case "object":if(!this.areObjectsEquivalent(a[c],
b[c]))return false;break;case "function":if(typeof b[c]=="undefined"||c!="equals"&&a[c].toString()!=b[c].toString())return false;break;default:if(a[c]!=b[c])return false}else if(b[c])return false;for(c in b)if(typeof a[c]=="undefined")return false;return true},clone:function(a,b,c){if(b===undefined)b={};for(var d in a)if(c===undefined||c.indexOf(d)<0)b[d]=a[d];return b},uniqueArray:function(a){var b=[],c=0,d=a.length;a:for(;c<d;c++){for(var e=0,f=b.length;e<f;e++)if(b[e]==a[c])continue a;b[b.length]=
a[c]}return b},isPointInPoly:function(a,b){for(var c=false,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d].y<=b.y&&b.y<a[f].y||a[f].y<=b.y&&b.y<a[d].y)&&b.x<(a[f].x-a[d].x)*(b.y-a[d].y)/(a[f].y-a[d].y)+a[d].x&&(c=!c);return c},jObjToPoly:function(a){var b=a.offset(),c=a.width();a=a.height();if(b&&b.left)return[{x:b.left-1,y:b.top},{x:b.left+c+15,y:b.top},{x:b.left+c+15,y:b.top+a},{x:b.left-1,y:b.top+a},{x:b.left-1,y:b.top}];return[{}]},replaceAll:function(a,b,c){for(var d=0;d>=0;){d=a.indexOf(b,d+c.length);
a=a.substring(0,d)+a.substring(d).replace(b,c)}return a},isDateLike:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(typeof b!="object"||b===null||typeof b.getTime!="function")return false}return true},isArrayLike:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=typeof b;if(c!="object"&&!(c=="function"&&typeof b.item=="function")||b===null||typeof b.length!="number")return false}return true},isNumeric:function(a){String(a).replace("\n","").replace("\r","").replace("\t",
"").replace(" ","");return a-0==a&&a.length>0},sum:function(a){return a.reduce(function(b,c){if(!c)return b;return b+c},0)},reverse:function(a){for(var b=new String,c=a.length;c--;)b+=a.charAt(c);return b},resizeIt:function(a){var b=a.val(),c=a.attr("cols"),d=0;b.split("\n").map(function(e){d+=1+Math.floor(e.length/c)});a.attr({rows:d>3?d:3})},resizeItSmall:function(a){var b=a.val(),c=a.attr("cols"),d=0;b.split("\n").map(function(e){d+=1+Math.floor(e.length/c)});a.attr({rows:d})},makeCharCountDiv:function(a,
b,c){var d=false;a.bind("keyup click blur focus change paste",function(){var e=c-jQuery(this).val().length;if(e<50){d||b.show();d=true;b.html(e)}else{d&&b.hide();d=false}})},_stripHtml:function(a){return jQuery("<div>"+a+"</div>").text()},stripHtml:function(a){a=this._stripHtml(a);if(this._stripHtml("<\n>")!=="&lt;\n&gt;")return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return a},formatString:function(a){return this.stripHtml(a).replace("\n"," ").replace("\r"," ").replace("<",
"(").replace(">",")").replace(">",")").replace("\\","/").replace(/"(?=\w|$)/g,"&#8220;").replace(/\b"/g,"&#8221;")},isValidString:function(a){return/^[\w \d \. \, \' \" \: \@ \; \? \- \# \\u2013 \& \( \) \! \s \: \; \- \! \r \+ \/ \* \\u2014 \\u2019]+$/i.test(a)},getUrlVars:function(){for(var a=[],b,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++){b=c[i].split("=");a.push(b[0]);a[b[0]]=b[1]}return a},getInputVal:function(a){return this.trim(a.val())},
getUrlVar:function(a){return this.getUrlVars()[a]},getHash:function(){return window.location.hash!==undefined&&window.location.hash.length>0?window.location.hash.slice().replace("#",""):undefined}};
